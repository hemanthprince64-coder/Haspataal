// Haspataal Database Schema
// Healthcare platform connecting patients with hospitals

generator client {
  provider = "prisma-client"
  output   = "../node_modules/.prisma/client"
}

datasource db {
  provider = "postgresql"
}

// ==========================================
// ENUMS
// ==========================================

enum HospitalStatus {
  PENDING
  APPROVED
  SUSPENDED
}

enum AppointmentStatus {
  PENDING
  CONFIRMED
  COMPLETED
  CANCELLED
}

enum PaymentStatus {
  PENDING
  SUCCESS
  FAILED
  REFUNDED
}

// ==========================================
// CORE MODELS
// ==========================================

enum Role {
  SUPER_ADMIN
  HOSPITAL_ADMIN
  DOCTOR
  STAFF
  PATIENT
}

// ==========================================
// CORE MODELS
// ==========================================

model Hospital {
  id        String         @id @default(uuid())
  name      String
  city      String
  address   String?
  phone     String         @unique
  password  String
  lat       Float?
  lng       Float?
  role      Role           @default(HOSPITAL_ADMIN) // Added
  status    HospitalStatus @default(PENDING)
  createdAt DateTime       @default(now()) @map("created_at")
  updatedAt DateTime       @updatedAt @map("updated_at")

  doctors Doctor[]
  visits  Visit[]
  staff   Staff[]        // Relation to new Staff model

  @@map("hospitals")
}

model Doctor {
  id            String   @id @default(uuid())
  hospitalId    String   @map("hospital_id")
  name          String
  specialty     String
  qualification String?
  experience    Int?     @default(0)
  mobile        String?  @unique
  password      String?  @default("123")
  role          Role     @default(DOCTOR) // Added
  fee           Int      @default(500)
  createdAt     DateTime @default(now()) @map("created_at")

  hospital     Hospital      @relation(fields: [hospitalId], references: [id], onDelete: Cascade)
  slots        Slot[]
  appointments Appointment[]

  @@map("doctors")
}

model Staff {
  id         String   @id @default(uuid())
  hospitalId String   @map("hospital_id")
  name       String
  mobile     String   @unique
  password   String
  role       Role     @default(STAFF)
  createdAt  DateTime @default(now()) @map("created_at")
  
  hospital   Hospital @relation(fields: [hospitalId], references: [id], onDelete: Cascade)

  @@map("staff")
}

model Patient {
  id        String   @id @default(uuid())
  name      String
  phone     String   @unique
  email     String?
  password  String
  city      String?
  role      Role     @default(PATIENT) // Added
  createdAt DateTime @default(now()) @map("created_at")

  appointments   Appointment[]
  medicalRecords MedicalRecord[]

  @@map("patients")
}

// ==========================================
// BOOKING MODELS
// ==========================================

model Slot {
  id       String @id @default(uuid())
  doctorId String @map("doctor_id")
  day      String // e.g., "Monday", "Tuesday"
  time     String // e.g., "09:00 AM", "02:30 PM"

  doctor Doctor @relation(fields: [doctorId], references: [id], onDelete: Cascade)

  @@unique([doctorId, day, time])
  @@map("slots")
}

model Appointment {
  id        String            @id @default(uuid())
  patientId String            @map("patient_id")
  doctorId  String            @map("doctor_id")
  date      DateTime          @db.Date
  slot      String            // time slot string
  status    AppointmentStatus @default(PENDING)
  notes     String?
  createdAt DateTime          @default(now()) @map("created_at")
  updatedAt DateTime          @updatedAt @map("updated_at")

  patient Patient  @relation(fields: [patientId], references: [id], onDelete: Cascade)
  doctor  Doctor   @relation(fields: [doctorId], references: [id], onDelete: Cascade)
  payment Payment?
  visit   Visit?

  @@map("appointments")
}

model Payment {
  id            String        @id @default(uuid())
  appointmentId String        @unique @map("appointment_id")
  amount        Int           // in paise (â‚¹500 = 50000)
  currency      String        @default("INR")
  orderId       String        @map("order_id")
  paymentId     String?       @map("payment_id")
  status        PaymentStatus @default(PENDING)
  createdAt     DateTime      @default(now()) @map("created_at")

  appointment Appointment @relation(fields: [appointmentId], references: [id], onDelete: Cascade)

  @@map("payments")
}

model Visit {
  id            String   @id @default(uuid())
  appointmentId String?  @unique @map("appointment_id")
  hospitalId    String   @map("hospital_id")
  patientName   String   @map("patient_name")
  patientPhone  String   @map("patient_phone")
  diagnosis     String?
  amount        Int      @default(0)
  createdAt     DateTime @default(now()) @map("created_at")

  appointment Appointment? @relation(fields: [appointmentId], references: [id])
  hospital    Hospital     @relation(fields: [hospitalId], references: [id], onDelete: Cascade)

  @@map("visits")
}

// ==========================================
// MEDICAL RECORDS (Phase 2)
// ==========================================

model MedicalRecord {
  id         String   @id @default(uuid())
  patientId  String   @map("patient_id")
  fileName   String   @map("file_name")
  fileUrl    String   @map("file_url")
  fileType   String?  @map("file_type") // pdf, jpg, png
  uploadedAt DateTime @default(now()) @map("uploaded_at")

  patient Patient @relation(fields: [patientId], references: [id], onDelete: Cascade)

  @@map("medical_records")
}
